---
title: "ê°„ë‹¨í•œ ì‡¼í•‘ëª° ë§Œë“¤ê¸°- intro2-1\U0001F4AA\U0001F3FB"
layout: post
categories:
- ê°„ë‹¨í•œì‡¼í•‘ëª°
- react-query
description: "ê°„ë‹¨í•œ ì‡¼í•‘ëª°-intro | react-query-hooks , example\U0001F33A"
image: https://images.velog.io/images/jkl1545/post/fdd77104-35d5-440b-a12f-5f94e1f1ea81/Group%2012.png
customexcerpt: ê°„ë‹¨í•œ ì‡¼í•‘ëª° |  React-query / Hooks / Examples
---

ì§€ì‹ì´ ë¶€ì¡±í•´ì„œ ì“¸ê²Œ ë„˜ ë§ìŒ.. ê·¸ë¦¬ê³  ë¸”ë¡œê·¸ ì ì‘ì•ˆë˜ì„œ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼... (ë¬¼ë¡  í•‘ê³„ ã…ã…)
ë­”ê°€ í•˜ë‚˜í•˜ë‚˜ ê°œë…ì¡ê³  ë§Œë“¤ë©´ ì‹œê°„ì´ ë„ˆë¬´ ë§ì´ ê±¸ë¦´ ê²ƒ ê°™ì•„ì„œ ë‘ê°€ì§€ ì˜ˆì œë¡œ ê°œë…ì„ ì¡ìœ¼ë ¤ê³  í•¨.

ì‚¬ì‹¤  Updateë˜ê±°ë‚˜ Deleteë˜ì—ˆì„ë•Œ ë‹¤ì‹œ getí•˜ëŠ” Mutationì´ë‚˜ , ì „ì—­ Stateë¡œ ì‚¬ìš©í•˜ëŠ” ì˜ˆì œë¥¼ ë§Œë“¤ì–´ë³´ê³  ì‹¶ì€ë° ê·¸ëŸ¼ strapi ì„¤ì •í•´ì„œ ë§Œë“¤ì–´ì•¼ í•¨...ã…œã…œã…œ ê°•ì˜ ë“¤ìœ¼ë©´ì„œ ê·¸ ë¶€ë¶„ì€ ë‹¤ì‹œ ë¸”ë¡œê¹…í•˜ê³  ,ì§€ê¸ˆì€ ê°„ë‹¨í•œ ì˜ˆì œë¥¼ í†µí•´ ì¥ì ì„ ì•Œì•„ë³¼êº¼ë‹¤. 

ë”ë¯¸ë°ì´í„°ëŠ” `jsonplaceholder`ë¥¼ ì‚¬ìš©í•´ë³´ì. 

# React-queryì˜ ì„¸ê°€ì§€ ì»¨ì…‰
**âœ” Queries**
**âœ” Mutations**
**âœ” Query Invalidation**

## â“ Quries

ë³´í†µ `GET`ìœ¼ë¡œ ë°›ì•„ì˜¬ ë•Œ ì‚¬ìš©í•œë‹¤ê³  í•¨.

{% highlight js %}
 const info= useQuery('todo',fetcher);
{%  endhighlight  %}
- ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„° : `unique key` => ë‹¤ë¥¸ì»´í¬ë„ŒíŠ¸ì—ì„œë„ í•´ë‹¹ í‚¤ë¥¼ í˜¸ì¶œí•˜ë©´ í˜¸ì¶œê°€ëŠ¥í•˜ë‹¤. `unique key`ëŠ” **String or ë°°ì—´** typeìœ¼ë¡œ ë°›ìœ¼ë©°, ë°°ì—´ì˜ ìš”ì†Œë¡œ ì¿¼ë¦¬ì˜ ì´ë¦„ì„ ë‚˜íƒ€ë‚´ëŠ” ë¬¸ìì—´ê³¼ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ì˜ ì¸ìë¡œ ì“°ì´ëŠ” ê°’ì„ ë„£ëŠ”ë‹¤.
- ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„° : `ë¹„ë™ê¸° í•¨ìˆ˜` => ë§Œì•½ í•œ ì»´í¬ë„ŒíŠ¸ì— ì—¬ëŸ¬ê°œ `useQuery`ê°€ ìˆë‹¤ë©´ ë‘ê°œê°€ ë™ì‹œì— ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.
- ì„¸ë²ˆì§¸ íŒŒë¼ë¯¸í„° (optional) : `option`
	>* onSuccess | onError( callback) : ì„±ê³µ ì‹¤íŒ¨ ì‹œ í•¨ìˆ˜
	>* enabled (boolean) : ìë™ìœ¼ë¡œ query ì‹¤í–‰ ì‹œí‚¬ ì§€ ì—¬ë¶€
	>* retry (boolean): ë™ì‘ ì‹¤íŒ¨ ì‹œ retry í•  ì§€ ì—¬ë¶€
	>* select  (callback) : ë°ì´í„° ê°€ê³µ callback

	ë“±ë“± ì—¬ëŸ¬ optionë“¤ì´ ìˆë‹¤. ë” ìì„¸í•œ optionì€ [ê³µì‹í™ˆí˜ì´ì§€ useQuery Option](https://react-query.tanstack.com/reference/useQuery#_top) ì°¸ê³ 

### useQuery Return
ìš”ì²­í•œ ì¿¼ë¦¬ëŠ” ì—¬ëŸ¬ê°€ì§€ ë°˜í™˜ê°’ì„ ê°–ëŠ”ë‹¤. ëŒ€í‘œì ìœ¼ë¡œ 

> * `data` : resolve ëœ ë°ì´í„°
> * `error` : ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ë°˜í™˜ë˜ëŠ” ê°ì²´
> * `isFetching` :  ë°ì´í„°ê°€ ë°›ì•„ì˜¤ëŠ” ì¤‘ì¼ë•Œ boolean
> * `status,isLoading,isError` : fetching statusì™€ ê´€ë ¨ëœ queryì˜ ìƒíƒœ 


## â“ Mutations
Updateí•  ë•Œ ì‚¬ìš©í•œë‹¤ê³  í•œë‹¤. post, put methodì¼ ë•Œ ì‚¬ìš©í•  ë“¯.

{% highlight js %}
 const info= useMutation(newTodo => axios.post('/todos',newTodo));
{% endhighlight %}

### useMutation ë°˜í™˜ê°’
ëŒ€í‘œì ìœ¼ë¡œ 

> * `mutate` : mutation ì‹¤í–‰ í•¨ìˆ˜
> * `mutateAsync` :  mutateì™€ ë¹„ìŠ·í•˜ì§€ë§Œ promise ë°˜í™˜
> * `reset` :  mutate ë‚´ë¶€ ìƒíƒœë¥¼ ì •ë¦¬í•˜ëŠ” í•¨ìˆ˜(ì¦‰, mutate ì´ˆê¸° ìƒíƒœë¡œ ì¬ì„¤ì •).
> * `data,error,isLoading,isError,isIdle`

## â“  Query Invalidation
ì–´ë–¤ ë¶„ ë§ì´ ì©ì€ ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ ì©ì€ ì¿¼ë¦¬ íê¸°í•˜ê³  í•¨.. 
ì¿¼ë¦¬ì˜ ë°ì´í„°ê°€ ìš”ì²­ì„ í†µí•´ ì„œë²„ì—ì„œ ë°”ë€Œì—ˆë‹¤ë©´, ë°±ê·¸ë¼ìš´ë“œì— ë‚¨ì•„ìˆëŠ” ë°ì´í„°ëŠ” ê³¼ê±°ì˜ ê²ƒì´ ë˜ì–´ ì•±ì—ì„œ ì“¸ëª¨ì—†ì–´ì§€ëŠ” ìƒí™©ì´ ë°œìƒí•˜ëŠ”ë°, ì´ ê²½ìš°  `invalidateQueries` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ íê¸°í•œë‹¤. 

{% highlight js %}
const queryClient= useQueryClient()
// ìºì‹œê°€ ìˆëŠ” ëª¨ë“  ì¿¼ë¦¬ë“¤ì„ íê¸°.
queryClient.invalidateQueries()
// 'todos'ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ì¿¼ë¦¬ë“¤ì„ íê¸°
queryClient.invalidateQueries('todos')
//mutation ì„±ê³µ í•  ì‹œ ì´ì „ ì¿¼ë¦¬ íê¸°í•˜ê³  ë¦¬íŒ¨ì¹­
 const mutation = useMutation(addTodo, {
   onSuccess: () => {
     queryClient.invalidateQueries('todos')
     queryClient.invalidateQueries('reminders')
   },
 })
{% endhighlight %}

## ğŸ—¨ ì˜ˆì‹œ - TodoList
{% highlight js %}
//App.js
import "./styles.css";
import Todo from  "./Todo";
import {QueryClientProvider,QueryClient} from "react-query"
export default function App() {
  const getClient= () => {
    let client=null;
    return !client? new QueryClient() :client
  }
	//ë‚˜ì¤‘ì— íŒŒì¼ ë”°ë¡œ ë§Œë“¤ì–´ì„œ ë¹¼ê³  ì¬ì‚¬ìš©í•˜ë ¤ê³  í•¨ìˆ˜ë¡œ ë§Œë“¬.
  return <QueryClientProvider client={getClient()}>
    <div className="App">
      <Todo />
      </div>
  </QueryClientProvider>;
}
{% endhighlight %}

{% highlight js %}
//Todo.js
import axios from "axios";
import { useQuery } from "react-query";
const Todo = () => {
const fetcher=async() => {
  const BASE_URL= `https://jsonplaceholder.typicode.com/todos`;
  const {data}= await axios.get(BASE_URL);
  return data
}
const {data,error,isLoading}= useQuery('todo',fetcher);
  if(isLoading) return <p>Loading..</p>
  if(error) return <p>Fuck ! Error! </p>
  return <ul>{
    data?.map(todo => <li key={todo.id}>{todo.title}</li>)
  }</ul>;
};
export default Todo;
{% endhighlight %}

![]({{ 'assets/img/query-todo.PNG' | relative_url }})

ì˜ ë¶ˆëŸ¬ì™€ì§„ë‹¤! ë” ìì„¸í•œ ë‚´ìš©ì€ ê°•ì˜ë¥¼ ë“¤ìœ¼ë©´ì„œ í¬ìŠ¤íŒ… í•˜ê¸°ë¡œ!
